---
name: Titanium.Network.Socket.TCP
type: Titanium.IOStream
summary: TCP socket that implements the `Titanium.IOStream` interface.  
description: |
    Use the `Titanium.Network.Socket.createTCP` method to create a TCP socket.
extends: Titanium.Proxy
since: "1.7"
platforms: [android, iphone, ipad]

properties:
  - name: host
    type: String
    summary: The host to connect to or listen on. 
    description: |
        Can only be modified when this socket is in the [INITIALIZED](Titanium.Network.Socket.INITIALIZED) state. 
        
        Supports both IPv4 and IPv6 addresses.
  - name: port
    type: Number
    summary: The port to connect to or listen on. 
    description: |
        Can only be modified when this socket is in the [INITIALIZED](Titanium.Network.Socket.INITIALIZED) state.

  - name: listenQueueSize
    type: Number
    summary: Max number of pending incoming connections to be allowed when the socket is
        in the [LISTENING](Titanium.Network.Socket.LISTENING) state.
    description: |
        Any incoming connections received while the max number of pending connections has 
        been reached will be rejected.

  - name: timeout
    type: Number
    summary: Timeout, in milliseconds, for `connect` and all `write` operations. 
    description: |
        Can only be modified when this socket is in the [INITIALIZED](Titanium.Network.Socket.INITIALIZED) state. 

  - name: connected
    type: Callback<ConnectedCallbackArgs>
    summary: Callback to be fired when the socket enters the "connected" state. 
    description: |
        Only invoked following a successful [connect](Titanium.Network.Socket.TCP.connect)
        call.

  - name: error
    type: Callback<ErrorCallbackArgs>
    summary: Callback to be fired when the socket enters the [ERROR](Titanium.Network.Socket.ERROR) state.

  - name: accepted
    type: Callback<AcceptedCallbackArgs>
    summary: Callback to be fired when a listener accepts a connection.

  - name: secured
    type: Callback<SecuredCallbackArgs>
    since: "1.8"
    summary: Callback to be fired when a connection is secured after calling the `startTLS` method.

  - name: state
    type: Number
    permission: read-only
    summary: Current state of the socket.
    description: |
        One of: [INITIALIZED](Titanium.Network.Socket.INITIALIZED), 
        [CONNECTED](Titanium.Network.Socket.CONNECTED), 
        [LISTENING](Titanium.Network.Socket.LISTENING), 
        [CLOSED](Titanium.Network.Socket.CLOSED), or
        [ERROR](Titanium.Network.Socket.ERROR).


methods:
  - name: connect
    summary: Attempts to connect the socket to its host/port. 
    description: |
        Throws an exception if the socket is in a [CONNECTED](Titanium.Network.Socket.CONNECTED) 
        or [LISTENING](Titanium.Network.Socket.LISTENING) state. 
        Throws an exception if a valid host and port has not been set on this socket. 
        
        Nonblocking; connection attempts are asynchronous

  - name: startTLS
    since: "1.8"
    summary: Attempts to establish a secure connection through the already connected socket. 
    description: |
        Nonblocking; connection attempts are asynchronous

  - name: listen
    summary: Attempts to start listening on the socket's host/port. 
    description: |
        The `listen` call will attempt to listen on the specified host and/or port 
        property for the socket if they are set. This function blocks execution and 
        throws an exception on error (and sets the socket state to [ERROR](Titanium.Network.Socket.ERROR)) but does not 
        fire the error callback in this event. Throws exception if the socket is in a 
        [LISTENING](Titanium.Network.Socket.LISTENING) or [CONNECTED](Titanium.Network.Socket.CONNECTED) state

  - name: accept
    summary: Tells a [LISTENING](Titanium.Network.Socket.LISTENING) socket to accept a connection request at the top of a listener's request queue when one becomes available. 
    description: |
        Takes an argument, a box object which assigns callbacks to the created socket. 

        Note that the connected callback is **not** called on the newly created socket.     
        This is because the socket is created in the 
        [CONNECTED](Titanium.Network.Socket.CONNECTED) state, so it never transitions
        to the `CONNECTED` state.

        The `accepted` callback is called when a new connection is accepted as a result of 
        calling `accept`.  If the socket is already flagged to accept the next connection, 
        the existing accept options will be updated to use the newly specified `options` object. 
        
        Throws an exception if the socket is not in a 
        [LISTENING](Titanium.Network.Socket.LISTENING) state.

    parameters:
      - name: options
        summary: Options to be set on next accepted socket.
        type: AcceptDict

  - name: close
    summary: Closes a socket. 
    description: |
        Throws exception if the socket is not in a [CONNECTED](Titanium.Network.Socket.CONNECTED) 
        or [LISTENING](Titanium.Network.Socket.LISTENING) state. Blocking

---
name: ConnectedCallbackArgs
summary: Argument object passed to the [connected](Titanium.Network.Socket.TCP.connected) callback when the socket connects.
description: |
    Only invoked following a successful [connect](Titanium.Network.Socket.TCP.connect)
    call.
since: "1.7"

properties:
  - name: socket
    summary: Socket instance that has been connected.
    type: Titanium.Network.Socket.TCP

---
name: SecuredCallbackArgs
summary: |
    Argument object passed to the [secured](Titanium.Network.Socket.TCP.secured)
    callback when the socket enters the secured state.
description: |
    Only invoked following a successful [startTLS](Titanium.Network.Socket.TCP.startTLS) 
    call.
since: "1.8"

properties:
  - name: socket
    summary: Socket instance that has been secured.
    type: Titanium.Network.Socket.TCP

---
name: ErrorCallbackArgs
summary: Object passed to the error callback when the socket enters 
    the [ERROR](Titanium.Network.Socket.ERROR) state.
since: "1.7"

properties:
  - name: socket
    summary: Socket that experienced the error.
    type: Titanium.Network.Socket.TCP

  - name: error
    summary: A text description of the error.
    type: String

  - name: errorCode
    summary: The error code of the error (potentially system-dependent).
    type: Number

---
name: AcceptedCallbackArgs
summary: |
    Argument object passed to the [accepted](Titanium.Network.Socket.TCP.accepted)
    callback when a listener accepts a connection.
since: "1.7"

properties:
  - name: socket
    summary: Socket which received the connection.
    type: Titanium.Network.Socket.TCP

  - name: inbound
    summary: Socket which represents the inbound connection.
    description: |
        This should be considered a 'connected' socket and is created in 
        the [CONNECTED](Titanium.Network.Socket.CONNECTED) state.
    type: Titanium.Network.Socket.TCP

---
name: AcceptDict
summary: Options object for the [accept](Titanium.Network.Socket.TCP.accept) method.
description: |
    Simple object that defines properties to be set on the next accepted socket.
since: "1.7"

properties:
  - name: timeout
    type: Number
    summary: Timeout, in milliseconds, for `connect` and all `write` operations. 
    description: |
        Can only be modified when this socket is in the 
        [INITIALIZED](Titanium.Network.Socket.INITIALIZED) state. 

  - name: error
    type: Callback<ErrorCallbackArgs>
    summary: Callback to be fired when the socket enters the [ERROR](Titanium.Network.Socket.ERROR) state.
